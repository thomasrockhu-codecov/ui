import { Meta, Story, Preview, Props } from '@storybook/addon-docs/blocks';
import FlexTable from './FlexTable';

<Meta title="Molecules | FlexTable" component={FlexTable} />

# FlexTable

Flextable is a table component built using the `Flexbox` component to allow responsive headers and columns.
The Flextable component only handles UI states.

<Preview>
  <FlexTable>
    <FlexTable.HeaderRow>
      <FlexTable.Header columnId="instrument-name">Instrument Name</FlexTable.Header>
      <FlexTable.Header columnId="currency">Currency</FlexTable.Header>
      <FlexTable.Header columnId="country">Country</FlexTable.Header>
    </FlexTable.HeaderRow>
    <FlexTable.Row>
      <FlexTable.Cell columnId="instrument-name">Ericsson</FlexTable.Cell>
      <FlexTable.Cell columnId="currency">SEK</FlexTable.Cell>
      <FlexTable.Cell columnId="country">SE</FlexTable.Cell>
    </FlexTable.Row>
    <FlexTable.Row>
      <FlexTable.Cell columnId="instrument-name">Apple</FlexTable.Cell>
      <FlexTable.Cell columnId="currency">USD</FlexTable.Cell>
      <FlexTable.Cell columnId="country">US</FlexTable.Cell>
    </FlexTable.Row>
    <FlexTable.Row>
      <FlexTable.Cell columnId="instrument-name">Nokia</FlexTable.Cell>
      <FlexTable.Cell columnId="currency">EUR</FlexTable.Cell>
      <FlexTable.Cell columnId="country">FI</FlexTable.Cell>
    </FlexTable.Row>
  </FlexTable>
</Preview>

## Row

Row has the important feature of managing expand states.
For it to know how to handle an out-of-the-box-expand it needs `expandItems` and/or `expandChildren`, alongside the parent `FlexTable` having `expandable = true`.
If neither `expandItems` or `expandChildren` are supplied, the chevron will be disabled.

Conditionally expand `expandItems` and/or `expandChildren` can be implemented in the following way:

```jsx
const ConditionalMediaExpand = () => {
  const columnData = [{ label: 'Country', value: 'SE' }];
  return (
    <StyledFlexTable expandable md={{ expandable: false }}>
      <FlexTable.HeaderRow>
        <FlexTable.Header columnId="instrumentName">Instrument Name</FlexTable.Header>
        <FlexTable.Header columnId="country" hidden md={{ hidden: false }}>
          Country
        </FlexTable.Header>
      </FlexTable.HeaderRow>

      <FlexTable.Row expandItems={columnData} md={{ expandItems: [] }}>
        <FlexTable.Cell columnId="instrumentName">Ericsson</FlexTable.Cell>
        <FlexTable.Cell columnId="country">SE</FlexTable.Cell>
      </FlexTable.Row>
    </StyledFlexTable>
  );
};
```

Several Media breakpoints can be used. The properties `expandItems` and `expandChildren` defaults to `xs`.

### Header Row & Footer Row

Header Row and Footer Row has the same functionality as an ordinary `Row` but with other default properties to fulfill their purpose.
Most notably, the property `isContent` is set to `false`.
This keeps the row from rendering a chevron and instead provides a empty `Header` with fixed properties with the same `columnId` as all the chevrons in the table.

## Header

Header sets the layout for the entire column and handles sorting as well. The layout is set using the same properties that `Flexbox`uses. Setting the same `columnId` on `Cell` and `Footer` makes them inherit the layout properties.
The `fontSize` and `density` defined in the `FlexTable` component is inherited here. If the content does not fit within the `Header`, it will be truncated and produces a tooltip on hover.

<Preview>
  <FlexTable>
    <FlexTable.HeaderRow>
      <FlexTable.Header columnId="instrument-name">Instrument Name (default)</FlexTable.Header>
      <FlexTable.Header columnId="currency" flex="0 0 150px">
        Currency (150px)
      </FlexTable.Header>
      <FlexTable.Header columnId="country" justifyContent="flex-end" flex="2">
        Country (flex 2, justify end)
      </FlexTable.Header>
    </FlexTable.HeaderRow>
    <FlexTable.Row>
      <FlexTable.Cell columnId="instrument-name">Ericsson</FlexTable.Cell>
      <FlexTable.Cell columnId="currency">SEK</FlexTable.Cell>
      <FlexTable.Cell columnId="country">SE</FlexTable.Cell>
    </FlexTable.Row>
  </FlexTable>
</Preview>

`Header` features conditional hiding based on `Media`. To hide columns e.g. if size `md` or smaller:

```jsx
<FlexTable.Header columnId="id" hidden md={{ hidden: false }}>
  Hidden on mobile
</FlexTable.Header>
```

### Sorting

To enable sorting, the `sortable` property has to be set to true. The user can have either a controlled or uncontrolled sorting state by setting the `sortOrder` property.
In an uncontrolled state the header will unsort the other headers when a header is sorted. The default sorting rotation is _unsorted --> ascending --> descending --> unsorted_

```jsx
const data = [
  {instrumentName: "Ericsson", currency: "SEK", country: "SE"},
  {instrumentName: "Apple", currency: "USD", country: "US"},
  {instrumentName: "Nokia", currency: "EUR", country: "FI"}
];

const InstrumentTable = () => (
  const [sorting, setSorting] = useState({columnId: "instrumentName", sortOrder: FlexTable.CONSTANTS.SORT_ORDER_NONE});
  const sortedData = useMemo(() => {
    if(sorting.sortOrder === FlexTable.CONSTANTS.SORT_ORDER_NONE){
      return data;
    }

    // Array sort mutates the original array, therefore you should always make a copy
    return data.slice(0).sort(
      (instrumentA,instrumentB ) =>
        sorting.sortOrder === FlexTable.CONSTANTS.SORT_ORDER_ASCENDING
        ? instrumentA[sorting.columnId].toLocaleCompare(instrumentB[sorting.columnId])
        : instrumentB[sorting.columnId].toLocaleCompare(instrumentA[sorting.columnId]);
      );
  }, [sorting, data]);

  return (
    <FlexTable>
      <FlexTable.HeaderRow>
        <FlexTable.Header columnId="instrumentName" sortable>Instrument Name</FlexTable.Header>
        <FlexTable.Header columnId="currency" sortable>Currency</FlexTable.Header>
        <FlexTable.Header columnId="country" sortable>Country</FlexTable.Header>
      </FlexTable.HeaderRow>
      {sortedData.map(({instrumentName, currency, country}) => (
        <FlexTable.Row>
          <FlexTable.Cell columnId="instrumentName">{instrumentName}</FlexTable.Cell>
          <FlexTable.Cell columnId="currency">{currency}</FlexTable.Cell>
          <FlexTable.Cell columnId="country">{country}</FlexTable.Cell>
        </FlexTable.Row>
      ))}
    </FlexTable>
  )
);
```

## Cell

Cell consumes the properties of the `Header` with the same `columnId`.
Cell wraps an `<InnerCell>` component that uses `React.memo` so that content is not rerendered on sort.
This also enables us retain TextWrapper-type on export.

## Footer

Similar functionality to `Cell`.

## Constants

1. `SORT_ORDER_NONE` / `SORT_ORDER_ASCENDING` / `SORT_ORDER_DESCENDING`

   To handle the correct `string` for sort orders. Are `'none'`, `'ascending'` and `'descending'` respectively.

1. `COLUMN_ID_EXPAND = 'column-expand'`

   The `id` that is assigned to `HeaderRow`'s empty `Header` and `Row`'s chevron.

1. `ICON_COLUMN_DEFAULT_FLEX_PROPS`

Assigns the `HeaderRow`'s empty `Header` its fixed properties:

```jsx
const ICON_COLUMN_DEFAULT_FLEX_PROPS: Pick<FlexPropsType, 'justifyContent' | 'flex'> = {
  justifyContent: 'flex-end',
  flex: `0 20px`,
};
```

## Component parts

## Responsitivity

## Performance
